= Roomのprimary keyを再利用しつつ自動インクリメントさせる
一時的にデータベースにデータを保存しておき、不要になった時点で削除するという運用をする場合、
プライマリキーは
- 自動採番
- 削除後のidは再利用可能
という条件になる。

この条件を満たすために

[source,kotlin]
----
@PrimaryKey(autoGenerate = true)
----

を設定していたが、この設定は期待通りに動作せず重大な問題が発生する恐れがあった。

== ``autoGenerate``の挙動
``autoGenerate``はMySQLで``AUTOINCREMENT``を付与したときと同様に
**これまでに設定された値+1**が自動的に設定される。
そのため``INT_MAX(2147483647)``に到達した時点でレコードを追加できなくなる可能性がある。
link:https://qiita.com/sakuraya/items/0dd0bb4114e56f42556d#%E6%9C%80%E5%A4%A7%E5%80%A4%E3%81%AB%E9%81%94%E3%81%97%E3%81%9F%E6%99%82[参考(MySQLのAUTO_INCREMENTについて色々と調べてみた。)]

今回の運用では延々とレコードが追加される仕様なので、レコードが追加できないと重大な問題が発生してしまう。

== 削除後は同じidを利用できるようにする
では自動採番かつ削除済みidを再利用するにはどうすれば良いのか。
結論としてはEntityを以下のように設定すれば良い。

[source,kotlin]
----
@PrimaryKey
var id: Int? = null
----

``autoGenerate``が無いため自動で設定される値は**現在のDBにある最大値+1**となる。
また、``null``が設定された際は自動で値が設定される。